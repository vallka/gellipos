{% extends "admin/change_form.html" %}
{% load i18n admin_urls %}

{% block extrahead %}{{ block.super }}
<script src="{% url 'admin:jsi18n' %}"></script>
<!-- 

 adminform.model_admin   {{ adminform.model_admin }}
 {{ adminform.prepopulated_fields }}

 {{ opts.model_name }}
 {{ opts.id }}

 -->
{% endblock %}
 

{% block submit_buttons_bottom %}
<hr>
{{ block.super }}
{% endblock %}

{% block admin_change_form_document_ready %}
{{ block.super }}



<script>

var code='';

function process(c) {
    console.log(c)

    let done = false;
    for (i=0; i<django.jQuery('.dynamic-orderdetail_set').length; i++) {
        console.log(done)

        let tr = django.jQuery('.dynamic-orderdetail_set')[i];

        console.log(tr)
        let sel = django.jQuery(tr).find('select')
        console.log(sel)
        if (!done && sel.val()=='') {
            console.log(sel.find('option'))
            sel.find('option').each(function(){
                console.log(done+' '+this.text)
            });
            done = true;
            break;
        }
    }
}

django.jQuery(function(){
    django.jQuery( "input" ).blur();


    django.jQuery( "body" ).keyup(function( event ) {
        //console.log( event.originalEvent.key + ' --- ' + code);
    
        if (event.originalEvent.key=='0' ||
            event.originalEvent.key=='1' ||
            event.originalEvent.key=='2' ||
            event.originalEvent.key=='3' ||
            event.originalEvent.key=='4' ||
            event.originalEvent.key=='5' ||
            event.originalEvent.key=='6' ||
            event.originalEvent.key=='7' ||
            event.originalEvent.key=='8' ||
            event.originalEvent.key=='9') {
                code += event.originalEvent.key;
        }
    
        else if (event.originalEvent.key=='Enter' && code.length==13) {
            event.preventDefault();
            const ccode = code;
            code = '';
            process(ccode);
        }
        else {
            code = '';
        }
    
    });

});

</script>

{% endblock %}